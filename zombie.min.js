/*! zombie 2014-06-06 */
(function(){var a,b,c,d,e;c=require("assert"),e=require("util").isRegExp,b=require("url"),d=function(a,b,d){return e(b)?c(b.test(a),d||"Expected '"+a+"' to match "+b):"function"==typeof b?c(b(a),d):c.deepEqual(a,b,d)},a=function(){function a(a){this.browser=a}return a.prototype.cookie=function(a,b,c){var e;return 1===arguments.length&&(b=null),e=this.browser.getCookie(a),c||(c="Expected cookie "+JSON.stringify(a)+" to have the value '"+b+"', found '"+e+"'"),d(e,b,c)},a.prototype.redirected=function(a){return c(this.browser.redirected,a)},a.prototype.status=function(a,b){return c.equal(this.browser.statusCode,a,b)},a.prototype.success=function(a){return c(this.browser.success,a)},a.prototype.url=function(a,c){var f,g,h,i,j,k;if("string"==typeof a)return f=b.resolve(this.browser.location.href,a),d(this.browser.location.href,f,c);if(e(a)||"function"==typeof a)return d(this.browser.location.href,a,c);i=b.parse(this.browser.location.href,!0),k=[];for(h in a)j=a[h],g="port"===h?80:null,k.push(d(i[h]||g,j||g,c));return k},a.prototype.attribute=function(a,b,e,f){var g,h,i,j,k,l;for(2===arguments.length&&(e=null),i=this.browser.queryAll(a),c(i.length>0,"Expected selector '"+a+"' to return one or more elements"),l=[],j=0,k=i.length;k>j;j++)h=i[j],g=h.getAttribute(b),l.push(d(g,e,f));return l},a.prototype.element=function(a,b){return this.elements(a,{exactly:1},b)},a.prototype.elements=function(a,b,d){var e;return e=this.browser.queryAll(a),1===arguments.length&&(b={atLeast:1}),b.exactly&&(b=b.exactly),"number"==typeof b?(d||(d="Expected "+b+" elements matching '"+a+"', found "+e.length),c.equal(e.length,b,d)):(b.atLeast&&(e=this.browser.queryAll(a),d||(d="Expected at least "+b.atLeast+" elements matching '"+a+"', found only "+e.length),c(e.length>=b.atLeast,d)),b.atMost?(d||(d="Expected at most "+b.atMost+" elements matching '"+a+"', found "+e.length),c(e.length<=b.atMost,d)):void 0)},a.prototype.hasClass=function(a,b,d){var e,f,g,h,i,j;for(g=this.browser.queryAll(a),c(g.length>0,"Expected selector '"+a+"' to return one or more elements"),j=[],h=0,i=g.length;i>h;h++)f=g[h],e=f.className.split(/\s+/),j.push(c(~e.indexOf(b),d||"Expected element '"+a+"' to have class "+b+", found "+e.join(", ")));return j},a.prototype.hasNoClass=function(a,b,d){var e,f,g,h,i,j;for(g=this.browser.queryAll(a),c(g.length>0,"Expected selector '"+a+"' to return one or more elements"),j=[],h=0,i=g.length;i>h;h++)f=g[h],e=f.className.split(/\s+/),j.push(c(-1===e.indexOf(b),d||"Expected element '"+a+"' to not have class "+b+", found "+e.join(", ")));return j},a.prototype.className=function(a,b,e){var f,g,h,i,j,k;for(h=this.browser.queryAll(a),c(h.length>0,"Expected selector '"+a+"' to return one or more elements"),b=b.split(/\s+/).sort().join(" "),k=[],i=0,j=h.length;j>i;i++)g=h[i],f=g.className.split(/\s+/).sort().join(" "),k.push(d(f,b,e||"Expected element '"+a+"' to have class "+b+", found "+f));return k},a.prototype.style=function(a,b,e,f){var g,h,i,j,k,l;for(2===arguments.length&&(e=null),i=this.browser.queryAll(a),c(i.length>0,"Expected selector '"+a+"' to return one or more elements"),l=[],j=0,k=i.length;k>j;j++)h=i[j],g=h.style[b],l.push(d(g,e,f||"Expected element '"+a+"' to have style "+b+" value of "+e+", found "+g));return l},a.prototype.input=function(a,b,e){var f,g,h,i,j;for(1===arguments.length&&(b=null),g=this.browser.queryAll(a),c(g.length>0,"Expected selector '"+a+"' to return one or more elements"),j=[],h=0,i=g.length;i>h;h++)f=g[h],j.push(d(f.value,b,e));return j},a.prototype.link=function(a,d,e){var f,g;return e=b.resolve(this.browser.location.href,e),f=this.browser.queryAll(a),c(f.length>0,"Expected selector '"+a+"' to return one or more elements"),g=f.filter(function(a){return a.textContent.trim()===d&&a.href===e}),c(g.length>0,"Expected at least one link matching the given text and URL")},a.prototype.text=function(a,b,e){var f,g;return g=this.browser.queryAll(a),c(g.length>0,"Expected selector '"+a+"' to return one or more elements"),f=g.map(function(a){return a.textContent}).join("").trim().replace(/\s+/g," "),d(f,b||"",e)},a.prototype.hasFocus=function(a){var b;return a?(b=this.browser.queryAll(a),c.equal(b.length,1,"Expected selector '"+a+"' to return one element"),c.equal(this.browser.activeElement,b[0],"Expected element '"+a+"' to have the focus'")):c.equal(this.browser.activeElement,this.browser.body,"Expected no element to have focus")},a.prototype.evaluate=function(a,b,e){var f;return f=this.browser.evaluate(a),1===arguments.length?c(f):d(f,b,e)},a.prototype.global=function(a,b,e){var f;return f=this.browser.window[a],1===arguments.length?c(f):(e||(e="Expected global "+a+" to have the value '"+b+"', found '"+f+"'"),d(f,b,e))},a.prototype.prompted=function(a,b){return c(this.browser.prompted(a),b)},a}(),module.exports=a}).call(this),function(){var a,b,c,d,e,f,g;g=require("child_process"),d=g.exec,f=g.spawn,e=require("http"),c={Darwin:{"default":"open",safari:"open -a Safari",firefox:"open -a Firefox",chrome:"open -a Google\\ Chrome",chromium:"open -a Chromium",opera:"open -a Opera",curl:"curl -s"},X11:{"default":"xdg-open",firefox:"firefox",chrome:"google-chrome",chromium:"chromium",mozilla:"mozilla",epiphany:"epiphany",curl:"curl -s"}},a={"google-chrome":"chrome","google chrome":"chrome",gnome:"epiphany"},b=function(){function b(){}return b.prototype.open=function(b,e){return d("uname",function(d,g){var h,i,j;if(d)throw new Error("Sorry, I don't support your operating system");if(j=/Darwin/.test(g)?"Darwin":/(Linux|BSD)/.test(g)?"X11":"X11",b=a[b]||b||"default",i=c[j][b],!i)throw new Error("Sorry, don't know how to run "+b);return h=f(i,["http://localhost:"+e+"/"]),h.stderr.on("data",function(a){return process.stdout.write(a)})})},b.prototype.serve=function(a,b){var c;return a.setEncoding&&a.pause&&(a.setEncoding("utf8"),a.pause()),c=e.createServer(function(b,d){return d.writeHead(200,{"Content-Type":"text/html"}),a.resume&&a.on?(a.resume(),a.on("data",function(a){return d.write(a,"utf8")}),a.on("end",function(){return d.end(),c.close(),process.exit(0)})):(d.write(a,"utf8"),d.end(),c.close(),process.exit(0))}),c.listen(b)},b}(),exports.bcat=function(a,c,d){var e;return null==c&&(c=8091),e=new b,a||(a=process.openStdin()),e.serve(a,c),process.stdout.write("open your browser on http://127.0.0.1:"+c+"/\n\n"),e.open(d,c)}}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E={}.hasOwnProperty,F=function(a,b){function c(){this.constructor=a}for(var d in b)E.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};A=require("assert"),a=require("./assert"),B=require("./tabs"),e=require("./console"),g=require("./cookies"),j=require("./dns_mask"),k=require("events").EventEmitter,l=require("./eventloop"),C=require("util").format,m=require("fs"),o=require("html5"),p=require("./interact"),n=require("jsdom").dom.level3.html,r=require("mime"),D=require("ms"),u=require("q"),s=require("path"),t=require("./port_map"),v=require("./resources"),w=require("./storage"),x=require("tough-cookie"),f=x.Cookie,y=require("url"),z=require("jsdom").dom.level3.xpath,require("./jsdom_patches"),require("./forms"),require("./dom_focus"),require("./dom_iframe"),c=["debug","features","headers","htmlParser","waitDuration","proxy","referer","silent","site","strictSSL","userAgent","maxRedirects","language","runScripts"],b=["scripts","css","img","iframe"],i="scripts no-css no-img iframe",q=["mousedown","mousemove","mouseup"],d=function(b){function d(b){var f,h,i,j,k,m,n,o;for(null==b&&(b={}),f=this,this.cookies=new g,this._storages=new w,this._interact=p.use(this),this._windowInScope=null,this.assert=new a(this),this.console=new e(this),this.on("console",function(a,b){if(!f.silent)switch(a){case"error":return process.stderr.write(b+"\n");case"debug":if(f.debug)return process.stdout.write(b+"\n");break;default:return process.stdout.write(b+"\n")}}),this.on("log",function(a){return f.debug?process.stdout.write("Zombie: "+a+"\n"):void 0}),this.referer=null,this.resources=new v(this),this.on("request",function(){}),this.on("response",function(a,b){return f.log(""+a.method+" "+a.url+" => "+b.statusCode)}),this.on("redirect",function(a,b){return f.log(""+a.method+" "+a.url+" => "+b.statusCode+" "+b.url)}),this.on("loaded",function(a){return f.log("Loaded document",a.location.href)}),this.tabs=B(this),this.on("opened",function(a){return f.log("Opened window",a.location.href,a.name||"")}),this.on("closed",function(a){return f.log("Closed window",a.location.href,a.name||"")}),this.on("active",function(a){var b,c;return c=a.document.createEvent("HTMLEvents"),c.initEvent("focus",!1,!1),a.dispatchEvent(c),(b=a.document.activeElement)?(c=a.document.createEvent("HTMLEvents"),c.initEvent("focus",!1,!1),b.dispatchEvent(c)):void 0}),this.on("inactive",function(a){var b,c;return(b=a.document.activeElement)&&(c=a.document.createEvent("HTMLEvents"),c.initEvent("blur",!1,!1),b.dispatchEvent(c)),c=a.document.createEvent("HTMLEvents"),c.initEvent("blur",!1,!1),a.dispatchEvent(c)}),this.eventLoop=new l(this),this.errors=[],this.on("error",function(a){return f.errors.push(a),f.console.error(a.message,a.stack)}),this.on("done",function(a){return f.log(a?"Event loop timed out":"Event loop is empty")}),this.on("timeout",function(a,b){return f.log("Fired timeout after "+b+"ms delay")}),this.on("interval",function(a,b){return f.log("Fired interval every "+b+"ms")}),this.on("link",function(a){return f.log("Follow link to "+a)}),this.on("submit",function(a){return f.log("Submit form to "+a)}),j=0,m=c.length;m>j;j++)i=c[j],b.hasOwnProperty(i)?this[i]=b[i]:d["default"].hasOwnProperty(i)&&(this[i]=d["default"][i]);for(o=d._extensions,k=0,n=o.length;n>k;k++)(h=o[k])(this)}return F(d,b),d.extend=function(a){return d._extensions.push(a)},d._extensions=[],d.prototype.hasFeature=function(a,b){var c;if(null==b&&(b=!0),this.features){if(c=this.features.split(/\s+/),~c.indexOf(a))return!0;if(~c.indexOf("no-"+a))return!1}return b},d.prototype.withOptions=function(a){var b,d,e,f;if(a){d={};for(b in a)e=a[b],~c.indexOf(b)&&(f=[this[b],e],d[b]=f[0],this[b]=f[1]);return function(a){return function(){var c;c=[];for(b in d)e=d[b],c.push(a[b]=e);return c}}(this)}return function(){}},d.prototype.fork=function(){var a,b,e,f,g;for(e={},f=0,g=c.length;g>f;f++)b=c[f],e[b]=this[b];return a=d.create(e),a.loadCookies(this.saveCookies()),a.loadStorage(this.saveStorage()),a.location=this.location.href,a},d.prototype.__defineGetter__("window",function(){return this.tabs.current}),d.prototype.open=function(a){var b,c,d;return a&&(d=a.url,b=a.name,c=a.referer),this.tabs.open({url:d,name:b,referer:c})},d.prototype.__defineGetter__("error",function(){return this.errors[this.errors.length-1]}),d.prototype.wait=function(a,b){var c,d,e,f;if(!this.window)return void process.nextTick(function(){return b(new Error("No window open"))});if(1===arguments.length&&"function"==typeof a&&(f=[a,null],b=f[0],a=f[1]),b&&"function"!=typeof b)throw new Error("Second argument expected to be a callback function or null");return"number"==typeof a?e=a:"string"==typeof a?e=a:"function"==typeof a?(e=this.waitDuration,c=a):a?(e=a.duration||this.waitDuration,c=a.element?function(b){return!!b.document.querySelector(a.element)}:a["function"]):e=this.waitDuration,d=this.eventLoop.wait(e,c),b&&d.done(b,b),d},d.prototype.fire=function(a,b,c){var d,e,f;if(!this.window)throw new Error("No window open");if(f=this.query(a),!f||!f.dispatchEvent)throw new Error("No target element (note: call with selector/element, event name and callback)");return e=~q.indexOf(b)?"MouseEvents":"HTMLEvents",d=this.document.createEvent(e),d.initEvent(b,!0,!0),f.dispatchEvent(d),this.wait(c)},d.prototype.click=function(a,b){return this.fire(a,"click",b)},d.prototype.dispatchEvent=function(a,b){var c;if(c=this.query(a),!this.window)throw new Error("No window open");return c.dispatchEvent(b)},d.prototype.queryAll=function(a,b){var c;return Array.isArray(a)?a:a instanceof n.Element?[a]:a?(b||(b=this.document),c=b.querySelectorAll(a),Array.prototype.slice.call(c,0)):[]},d.prototype.query=function(a,b){return a instanceof n.Element?a:a?(b||(b=this.document),b.querySelector(a)):b},d.prototype.$$=function(a,b){return this.query(a,b)},d.prototype.querySelector=function(a){return this.document.querySelector(a)},d.prototype.querySelectorAll=function(a){return this.document.querySelectorAll(a)},d.prototype.text=function(a,b){return this.document.documentElement?this.queryAll(a||"html",b).map(function(a){return a.textContent}).join("").trim().replace(/\s+/g," "):this.source?this.source.toString():""},d.prototype.html=function(a,b){return this.document.documentElement?this.queryAll(a||"html",b).map(function(a){return a.outerHTML.trim()}).join(""):this.source?this.source.toString():""},d.prototype.xpath=function(a,b){return this.document.evaluate(a,b||this.document.documentElement,null,z.XPathResult.ANY_TYPE)},d.prototype.__defineGetter__("document",function(){return this.window?this.window.document:void 0}),d.prototype.__defineGetter__("body",function(){return this.document.querySelector("body")}),d.prototype.__defineGetter__("activeElement",function(){return this.document.activeElement}),d.prototype.close=function(){return this.tabs.close.apply(this.tabs,arguments)},d.prototype.destroy=function(){return this.tabs?(this.tabs.closeAll(),this.tabs=null):void 0},d.prototype.visit=function(a,b,c){var d,e,f,g;return"function"!=typeof b||c||(g=[b,null],c=g[0],b=g[1]),e=this.withOptions(b),(f=this.site)&&(/^(https?:|file:)/i.test(f)||(f="http://"+f),a=y.resolve(f,y.parse(y.format(a)))),this.window&&this.tabs.close(this.window),this.tabs.open({url:a,referer:this.referer}),d=this.wait(b),d["finally"](e),c&&d.done(c,c),d},d.prototype.load=function(a,b){var c,d,e;this.location="about:blank";try{this.errors=[],this.document.readyState="loading",this.document.open(),this.document.write(a),this.document.close()}catch(f){d=f,this.emit("error",d)}return(e=this.errors[0])?b?void process.nextTick(function(){return b(e)}):(c=u.defer(),c.reject(e),c.promise):this.wait(b)},d.prototype.__defineGetter__("location",function(){return this.window?this.window.location:void 0}),d.prototype.__defineSetter__("location",function(a){return this.window?this.window.location=a:this.open({url:a})}),d.prototype.__defineGetter__("url",function(){return this.window?y.format(this.window.location):void 0}),d.prototype.link=function(a){var b,c,d,e;if(a instanceof n.Element)return a;if(b=this.querySelector(a),b&&"A"===b.tagName)return b;for(e=this.querySelectorAll("body a"),c=0,d=e.length;d>c;c++)if(b=e[c],b.textContent.trim()===a)return b;return null},d.prototype.clickLink=function(a,b){var c;if(!(c=this.link(a)))throw new Error("No link matching '"+a+"'");return this.click(c,b)},d.prototype.__defineGetter__("history",function(){return this.window||this.open(),this.window.history}),d.prototype.back=function(a){return this.window.history.back(),this.wait(a)},d.prototype.reload=function(a){return this.window.location.reload(),this.wait(a)},d.prototype.authenticate=function(a,b){var c,d;return null==b&&(b=!0),a||(a="*"),c=null!=(d=this._credentials)?d[a]:void 0,c||(b?(c=new h,this._credentials||(this._credentials={}),this._credentials[a]=c):c=this.authenticate()),c},d.prototype.saveHistory=function(){return this.window.history.save()},d.prototype.loadHistory=function(a){return this.window.history.load(a)},d.prototype.field=function(a){var b,c,d,e,f,g,h,i,j,k;if(a instanceof n.Element)return a;try{if(c=this.query(a),c&&("INPUT"===c.tagName||"TEXTAREA"===c.tagName||"SELECT"===c.tagName))return c}catch(l){b=l}for(j=this.queryAll("input[name],textarea[name],select[name]"),f=0,h=j.length;h>f;f++)if(c=j[f],c.getAttribute("name")===a)return c;for(k=this.queryAll("label"),g=0,i=k.length;i>g;g++)if(e=k[g],e.textContent.trim()===a)return(d=e.getAttribute("for"))?this.document.getElementById(d):e.querySelector("input,textarea,select")},d.prototype.focus=function(a){var b;if(b=this.field(a)||this.query(a),!b)throw new Error("No form field matching '"+a+"'");return b.focus(),this},d.prototype.fill=function(a,b){var c;if(c=this.field(a),!c||"TEXTAREA"!==c.tagName&&"INPUT"!==c.tagName)throw new Error("No INPUT matching '"+a+"'");if(c.getAttribute("disabled"))throw new Error("This INPUT field is disabled");if(c.getAttribute("readonly"))throw new Error("This INPUT field is readonly");return c.focus(),c.value=b,this.fire(c,"input"),c.blur(),this},d.prototype._setCheckbox=function(a,b){var c;if(c=this.field(a),!c||"INPUT"!==c.tagName||"checkbox"!==c.type)throw new Error("No checkbox INPUT matching '"+a+"'");if(c.getAttribute("disabled"))throw new Error("This INPUT field is disabled");if(c.getAttribute("readonly"))throw new Error("This INPUT field is readonly");return c.checked^b&&c.click(),this},d.prototype.check=function(a){return this._setCheckbox(a,!0)},d.prototype.uncheck=function(a){return this._setCheckbox(a,!1)},d.prototype.choose=function(a){var b;if(b=this.field(a)||this.field('input[type=radio][value="'+escape(a)+'"]'),!b||"INPUT"!==b.tagName||"radio"!==b.type)throw new Error("No radio INPUT matching '"+a+"'");return b.click(),this},d.prototype._findOption=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;if(c=this.field(a),!c||"SELECT"!==c.tagName)throw new Error("No SELECT matching '"+a+"'");if(c.getAttribute("disabled"))throw new Error("This SELECT field is disabled");if(c.getAttribute("readonly"))throw new Error("This SELECT field is readonly");for(k=c.options,e=0,h=k.length;h>e;e++)if(d=k[e],d.value===b)return d;for(l=c.options,f=0,i=l.length;i>f;f++)if(d=l[f],d.label===b)return d;for(m=c.options,g=0,j=m.length;j>g;g++)if(d=m[g],d.textContent.trim()===b)return d;throw new Error("No OPTION '"+b+"'")},d.prototype.select=function(a,b){var c;return c=this._findOption(a,b),this.selectOption(c),this},d.prototype.selectOption=function(a){var b,c;return b=this.query(a),b&&!b.getAttribute("selected")&&(c=this.xpath("./ancestor::select",b).iterateNext(),b.setAttribute("selected","selected"),c.focus(),this.fire(c,"change")),this},d.prototype.unselect=function(a,b){var c;return c=this._findOption(a,b),this.unselectOption(c),this},d.prototype.unselectOption=function(a){var b,c;if(b=this.query(a),b&&b.getAttribute("selected")){if(c=this.xpath("./ancestor::select",b).iterateNext(),!c.multiple)throw new Error("Cannot unselect in single select");b.removeAttribute("selected"),c.focus(),this.fire(c,"change")}return this},d.prototype.attach=function(a,b){var c,d,e;if(c=this.field(a),!c||"INPUT"!==c.tagName||"file"!==c.type)throw new Error("No file INPUT matching '"+a+"'");return b&&(e=m.statSync(b),d=new this.window.File,d.name=s.basename(b),d.type=r.lookup(b),d.size=e.size,c.files||(c.files=[]),c.files.push(d),c.value=b),c.focus(),this.fire(c,"change"),this},d.prototype.button=function(a){var b,c,d,e,f,g,h,i,j,k;if(a instanceof n.Element)return a;if((b=this.querySelector(a))&&("BUTTON"===b.tagName||"INPUT"===b.tagName))return b;for(k=this.querySelectorAll("button"),e=0,h=k.length;h>e;e++)if(b=k[e],b.textContent.trim()===a)return b;for(d=this.querySelectorAll("input[type=submit],button"),f=0,i=d.length;i>f;f++)if(c=d[f],c.name===a)return c;for(g=0,j=d.length;j>g;g++)if(c=d[g],c.value===a)return c},d.prototype.pressButton=function(a,b){var c;if(!(c=this.button(a)))throw new Error("No BUTTON '"+a+"'");if(c.getAttribute("disabled"))throw new Error("This button is disabled");return c.focus(),this.fire(c,"click"),this.wait(b)},d.prototype.getCookie=function(a,b){var c;return a=this._cookieIdentifier(a),A(a.name,"Missing cookie name"),A(a.domain,"No domain specified and no open page"),c=this.cookies.select(a)[0],c?b?this._cookieProperties(c):c.value:null},d.prototype.deleteCookie=function(a){var b;return a=this._cookieIdentifier(a),A(a.name,"Missing cookie name"),A(a.domain,"No domain specified and no open page"),b=this.cookies.select(a)[0],b?(this.cookies["delete"](b),!0):!1},d.prototype.setCookie=function(a,b){var c,d;(d=this.location)&&(c=d.hostname),"string"==typeof a?this.cookies.set({name:a,value:b||"",domain:c,path:"/",secure:!1,httpOnly:!1}):(A(a.name,"Missing cookie name"),this.cookies.set({name:a.name,value:a.value||b||"",domain:a.domain||c,path:a.path||"/",secure:!!a.secure,httpOnly:!!a.httpOnly,expires:a.expires,"max-age":a["max-age"]}))},d.prototype.deleteCookies=function(){this.cookies.deleteAll()},d.prototype.saveCookies=function(){var a,b,c,d,e;for(b=["# Saved on "+(new Date).toISOString()],e=this.cookies.sort(x.cookieCompare),c=0,d=e.length;d>c;c++)a=e[c],b.push(a.toString());return b.join("\n")+"\n"},d.prototype.loadCookies=function(a){var b,c,d,e,g;for(e=a.split(/\n+/),g=[],c=0,d=e.length;d>c;c++)b=e[c],b=b.trim(),"#"!==b[0]&&""!==b&&g.push(this.cookies.push(f.parse(b)));return g},d.prototype._cookieProperties=function(a){var b;return b={name:a.key,value:a.value,domain:a.domain,path:a.path},a.secure&&(b.secure=!0),a.httpOnly&&(b.httpOnly=!0),a.expires&&a.expires<1/0&&(b.expires=a.expires),b},d.prototype._cookieIdentifier=function(a){var b,c,d;return c=this.location,b=c&&c.hostname,d=c&&c.pathname||"/",a="string"==typeof a?{name:a,domain:b,path:d}:{name:a.name,domain:a.domain||b,path:a.path||d}},d.prototype.localStorage=function(a){return this._storages.local(a)},d.prototype.sessionStorage=function(a){return this._storages.session(a)},d.prototype.saveStorage=function(){return this._storages.save()},d.prototype.loadStorage=function(a){return this._storages.load(a)},d.prototype.evaluate=function(a,b){return this.window||this.open(),this.window._evaluate(a,b)},d.prototype.inject=function(a,b){var c,d;d=this.window.document.createElement("script"),d.onload=function(a){return function(){return b(null,a)}}(this),d.onerror=function(a){return function(c){return b(c,a)}}(this),d.src=a;try{return this.window.document.documentElement.appendChild(d)}catch(e){return c=e,b(c,this)}},d.prototype.onalert=function(a){return this._interact.onalert(a)},d.prototype.onconfirm=function(a,b){return this._interact.onconfirm(a,b)},d.prototype.onprompt=function(a,b){return this._interact.onprompt(a,b)},d.prototype.prompted=function(a){return this._interact.prompted(a)},d.prototype.__defineGetter__("statusCode",function(){return this.window&&this.window._response?this.window._response.statusCode:null}),d.prototype.__defineGetter__("success",function(){var a;return a=this.statusCode,a>=200&&400>a}),d.prototype.__defineGetter__("redirected",function(){return this.window&&this.window._response&&this.window._response.redirects>0}),d.prototype.__defineGetter__("source",function(){return this.window&&this.window._response?this.window._response.body:null}),d.prototype.viewInBrowser=function(){return require("./bcat").bcat(this.html())},d.prototype.log=function(){var a;return a="function"==typeof arguments[0]?[arguments[0]()]:arguments,this.emit("log",C.apply(null,a))},d.prototype.dump=function(){var a,b;return b=function(a){return a.map(function(a){return"  "+a+"\n"}).join("")},process.stdout.write("Zombie: "+d.VERSION+"\n\n"),process.stdout.write("URL: "+this.window.location.href+"\n"),process.stdout.write("History:\n"+b(this.window.history.dump())+"\n"),process.stdout.write("Cookies:\n"+b(this.cookies.dump())+"\n"),process.stdout.write("Storage:\n"+b(this._storages.dump())+"\n"),process.stdout.write("Eventloop:\n"+b(this.eventLoop.dump())+"\n"),this.document?(a=this.document.outerHTML,a.length>497&&(a=a.slice(0,497)+"..."),process.stdout.write("Document:\n"+b(a.split("\n"))+"\n")):this.document?void 0:process.stdout.write("No document\n")},d}(k),d.VERSION=JSON.parse(m.readFileSync(""+__dirname+"/../../package.json")).version,d["default"]={debug:!1,features:i,htmlParser:o,maxRedirects:5,proxy:null,silent:!1,site:void 0,strictSSL:!1,userAgent:"Mozilla/5.0 Chrome/10.0.613.0 Safari/534.15 Zombie.js/"+d.VERSION,language:"en-US",waitDuration:"5s",runScripts:!0},d.create=function(a){return new d(a)},d.dns=new j,d.ports=new t,d.localhost=function(a,b){return d.dns.localhost(a),d.ports.map(a,b),d["default"].site?void 0:d["default"].site=a.replace(/^\*\./,"")},h=function(){function a(){}return a.prototype.apply=function(a){var b;switch(this.scheme){case"basic":return b=new Buffer(this.user+":"+this.password).toString("base64"),a.authorization="Basic "+b;case"bearer":return a.authorization="Bearer "+this.token;case"oauth":return a.authorization="OAuth "+this.token}},a.prototype.basic=function(a,b){return this.user=a,this.password=b,this.scheme="basic"},a.prototype.bearer=function(a){return this.token=a,this.scheme="bearer"},a.prototype.oauth=function(a){return this.token=a,this.scheme="oauth"},a.prototype.reset=function(){return delete this.scheme,delete this.token,delete this.user,delete this.password},a}(),module.exports=d}.call(this),function(){var a,b,c,d,e=[].slice;d=require("util"),b=d.format,c=d.inspect,a=function(){function a(a){this.browser=a}return a.prototype.assert=function(a){var c;if(!a)throw c="Assertion failed:"+b.apply(null,[""].concat(e.call(Array.prototype.slice.call(arguments,1)))),this.browser.emit("console","error",c),new Error(c)},a.prototype.count=function(a){var b,c;this.counters||(this.counters={}),(c=this.counters)[a]||(c[a]=0),this.counters[a]++,b=""+a+": "+this.counters[a],this.browser.emit("console","log",b)},a.prototype.debug=function(){this.browser.emit("console","debug",b.apply(null,arguments))},a.prototype.error=function(){this.browser.emit("console","error",b.apply(null,arguments))},a.prototype.group=function(){},a.prototype.groupCollapsed=function(){},a.prototype.groupEnd=function(){},a.prototype.dir=function(a){this.browser.emit("console","log",c(a))},a.prototype.info=function(){this.browser.emit("console","info",b.apply(null,arguments))},a.prototype.log=function(){this.browser.emit("console","log",b.apply(null,arguments))},a.prototype.time=function(a){return this.timers||(this.timers={}),this.timers[a]=Date.now()},a.prototype.timeEnd=function(a){var b,c;this.timers&&(c=this.timers[a])&&(delete this.timers[a],b=""+a+": "+(Date.now()-c)+"ms",this.browser.emit("console","log",b))},a.prototype.trace=function(){var a,b;b=(new Error).stack.split("\n"),b[0]="console.trace()",a=b.join("\n"),this.browser.emit("console","trace",a)},a.prototype.warn=function(){this.browser.emit("console","warn",b.apply(null,arguments))},a}(),module.exports=a}.call(this),function(){var a,b,c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=require("assert"),c=require("jsdom").dom.level3.html,d=require("tough-cookie"),a=d.Cookie,module.exports=b=function(b){function c(){}return g(c,b),c.prototype.dump=function(){var a,b,c,e,f;for(e=this.sort(d.cookieCompare),f=[],b=0,c=e.length;c>b;b++)a=e[b],f.push(process.stdout.write(a.toString()+"\n"));return f},c.prototype.serialize=function(a,b){return this.select({domain:a,path:b}).map(function(a){return a.cookieString()}).join("; ")},c.prototype.select=function(a){var b;return b=this.filter(function(a){return a.TTL()>0}),a.name&&(b=b.filter(function(b){return b.key===a.name})),a.path&&(b=b.filter(function(b){return d.pathMatch(a.path,b.path)})),a.domain&&(b=b.filter(function(b){return d.domainMatch(a.domain,b.domain)})),b.sort(function(a,b){return b.domain.length-a.domain.length}).sort(d.cookieCompare)},c.prototype.set=function(b){var c,d;c=new a({key:b.name,value:b.value,domain:b.domain||"localhost",path:b.path||"/"}),b.expires?c.setExpires(b.expires):b.hasOwnProperty("max-age")&&c.setMaxAge(b["max-age"]),c.secure=!!b.secure,c.httpOnly=!!b.httpOnly,d=this.filter(function(a){return a.key===c.key&&a.domain===c.domain&&a.path===c.path})[0],this["delete"](d),c.TTL()>0&&this.push(c)},c.prototype["delete"]=function(a){var b;return b=this.indexOf(a),~b?this.splice(b,1):void 0},c.prototype.deleteAll=function(){return this.length=0},c.prototype.update=function(b,c,e){var f,g,h,i,j;for(b.constructor===Array&&(b=b.join(",")),j=b.split(/,(?=[^;,]*=)|,$/),h=0,i=j.length;i>h;h++)f=j[h],f=a.parse(f),f&&(f.domain||(f.domain=c),f.path||(f.path=d.defaultPath(e)),g=this.filter(function(a){return a.key===f.key&&a.domain===f.domain&&a.path===f.path})[0],this["delete"](g),f.TTL()>0&&this.push(f))},c}(Array),c.HTMLDocument.prototype.__defineGetter__("cookie",function(){return this.window.browser.cookies.select({domain:this.location.hostname,path:this.location.pathname}).filter(function(a){return!a.httpOnly}).map(function(a){return""+a.key+"="+a.value}).join("; ")}),c.HTMLDocument.prototype.__defineSetter__("cookie",function(a){return this.window.browser.cookies.update(a.toString(),this.location.hostname,this.location.pathname)})}.call(this),function(){var a,b,c;a=require("dns"),c=require("net"),b=function(){function b(){this._domains={},this._lookup=a.lookup,a.lookup=this.lookup.bind(this),this._resolve=a.resolve,a.resolve=this.resolve.bind(this),this._resolveMx=a.resolve,a.resolveMx=this.resolveMx.bind(this)}return b.prototype.localhost=function(a){return this.map(a,"A","127.0.0.1"),this.map(a,"AAAA","::1")},b.prototype.map=function(a,b,d){var e;if(2===arguments.length)switch(d=b,c.isIP(d)){case 4:b="A";break;case 6:b="AAAA";break;default:b="CNAME"}return d?((e=this._domains)[a]||(e[a]={}),this._domains[a][b]=d):this.unmap(a,b)},b.prototype.unmap=function(a,b){var c;return b?((c=this._domains)[a]||(c[a]={}),delete this._domains[a][b]):delete this._domains[a]},b.prototype.lookup=function(a,b,d){var e,f;if(2===arguments.length&&(f=[null,b],b=f[0],d=f[1]),c.isIP(a))return void setImmediate(function(){return d(null,a,c.isIP(a))});switch(e=this._find(a,"CNAME"),e&&(a=e),b){case 4:return this.resolve(a,"A",function(){return function(a,b){return d(a,b&&b[0],4)}}(this));case 6:return this.resolve(a,"AAAA",function(){return function(a,b){return d(a,b&&b[0],6)}}(this));case null:return this.resolve(a,"A",function(c){return function(e,f){return f?d(e,f&&f[0],4):c.resolve(a,"AAAA",function(e,f){return f?d(e,f&&f[0],6):c._lookup(a,b,d)})}}(this));default:throw new Error("Unknown family "+b)}},b.prototype.resolve=function(a,b,c){var d,e;return 2===arguments.length&&(e=["A",b],b=e[0],c=e[1]),d=this._find(a,b),d?setImmediate(function(){return c(null,[d])}):this._resolve(a,b,c)},b.prototype.resolveMx=function(a,b){var c;return c=this._find(a,"MX"),c?setImmediate(function(){return b(null,[c])}):this._resolveMx(a,b)},b.prototype._find=function(a,b){var c,d,e,f,g;for(e=a.split("."),c=[a,"*."+a],d=f=1,g=e.length;g>=1?g>f:f>g;d=g>=1?++f:--f)c.push("*."+e.slice(d,+e.length+1||9e9).join("."));return c.map(function(a){return function(b){return a._domains[b]}}(this)).map(function(){return function(a){return a&&a[b]}}(this)).filter(function(a){return a})[0]},b}(),module.exports=b}.call(this),function(){var a,b,c,d,e;b=require("jsdom"),a=b.dom.level3.html,d=require("path"),c=require(d.resolve(require.resolve("jsdom"),"../jsdom/selectors/index")),module.exports=e=function(d,e,f){var g,h,i;return h={MutationEvents:"2.0",ProcessExternalResources:[],FetchExternalResources:[],QuerySelector:!0},i=b.browserAugmentation(a,{parser:d.htmlParser}),g=new i.HTMLDocument({referrer:f}),c.applyQuerySelectorPrototype(a),d.hasFeature("scripts",!0)&&(h.ProcessExternalResources.push("script"),h.FetchExternalResources.push("script")),d.hasFeature("css",!1)&&(h.FetchExternalResources.push("css"),h.FetchExternalResources.push("link")),d.hasFeature("img",!1)&&h.FetchExternalResources.push("img"),d.hasFeature("iframe",!0)&&h.FetchExternalResources.push("iframe"),b.applyDocumentFeatures(g,h),Object.defineProperty(g,"window",{value:e}),Object.defineProperty(g,"parentWindow",{value:e.parent}),Object.defineProperty(g,"location",{get:function(){return e.location},set:function(a){return e.location=a}}),Object.defineProperty(g,"URL",{get:function(){return e.location.href}}),g}}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k;for(b=require("jsdom").dom.level3.html,a=["INPUT","SELECT","TEXTAREA","BUTTON","ANCHOR"],b.HTMLDocument.prototype.__defineGetter__("activeElement",function(){return this._inFocus||this.body
}),e=function(a,b){var c,d,e;return c=a._inFocus,b!==c&&(c&&(d=a.createEvent("HTMLEvents"),d.initEvent("blur",!1,!1),c.dispatchEvent(d)),b)?(e=a.createEvent("HTMLEvents"),e.initEvent("focus",!1,!1),b.dispatchEvent(e),a._inFocus=b,a.window.browser.emit("focus",b)):void 0},b.HTMLElement.prototype.focus=function(){},b.HTMLElement.prototype.blur=function(){},j=[b.HTMLInputElement,b.HTMLSelectElement,b.HTMLTextAreaElement,b.HTMLButtonElement,b.HTMLAnchorElement],f=0,h=j.length;h>f;f++)c=j[f],c.prototype.focus=function(){return e(this.ownerDocument,this)},c.prototype.blur=function(){return e(this.ownerDocument,null)},d=c.prototype.setAttribute,c.prototype.setAttribute=function(b,c){var e;return d.call(this,b,c),"autofocus"===b&&(e=this.ownerDocument,~a.indexOf(this.tagName)&&!e._inFocus)?this.focus():void 0};for(k=[b.HTMLInputElement,b.HTMLTextAreaElement,b.HTMLSelectElement],g=0,i=k.length;i>g;g++)c=k[g],c.prototype._eventDefaults.focus=function(a){var b;return b=a.target,b._focusValue=b.value||""},c.prototype._eventDefaults.blur=function(a){var b,c,d;return c=a.target,d=c._focusValue,d!==c.value?(b=c.ownerDocument.createEvent("HTMLEvents"),b.initEvent("change",!1,!1),c.dispatchEvent(b)):void 0}}.call(this),function(){var a,b,c;b=require("./history"),a=require("jsdom").dom.level3.html,c=a.HTMLFrameElement._init,a.HTMLFrameElement._init=function(){var a,d,e,f;return c.call(this),e=this,f=e.ownerDocument.parentWindow,a=null,Object.defineProperties(e,{contentWindow:{get:function(){return a||d()}},contentDocument:{get:function(){return(a||d()).document}}}),d=function(c){var d,g;return d=function(b){return a=b},g=b(f.browser,d),a=g({name:e.name,parent:f,url:c})}},a.HTMLFrameElement.prototype.setAttribute=function(b,c){return a.HTMLElement.prototype.setAttribute.call(this,b,c)},a.HTMLFrameElement.prototype._attrModified=function(b,c,d){var e,f;return a.HTMLElement.prototype._attrModified.call(this,b,c,d),"name"===b?this.ownerDocument.parentWindow.__defineGetter__(c,function(a){return function(){return a.contentWindow}}(this)):"src"===b&&c?(f=a.resourceLoader.resolve(this.ownerDocument,c),this.contentWindow.location=f,e=function(a){return function(){return a.contentWindow.removeEventListener("load",e),e=a.ownerDocument.createEvent("HTMLEvents"),e.initEvent("load",!0,!1),a.dispatchEvent(e)}}(this),this.contentWindow.addEventListener("load",e)):void 0}}.call(this),function(){var a,b,c,d,e,f;f=require("ms"),d=require("q"),global.setImmediate||(global.setImmediate=process.nextTick),a=function(){function a(a){this.browser=a,this.active=null,this.expected=0,this.running=!1,this.listeners=[]}return a.prototype.wait=function(a,b){var c,e,g,h,i,j,k;return c=d.defer(),h=c.promise,a=f(a.toString())||this.browser.waitDuration,j=Date.now()+a,k=global.setTimeout(function(){return c.resolve()},a),e={tick:function(a){return function(d){var e,f,g;if(d>=j)c.resolve();else if(b&&a.active.document.documentElement)try{g=Math.max(d-Date.now(),0),e=b(a.active,g),e&&c.resolve()}catch(h){f=h,c.reject(f)}}}(this),done:c.resolve,error:c.reject},g=function(a,b){return e[a](b)},this.listeners.push(g),this.browser.addListener("error",c.reject),i=function(a){return function(){clearTimeout(k),a.browser.removeListener("error",c.reject),a.listeners=a.listeners.filter(function(a){return a!==g}),0===a.listeners.length&&a.emit("done")}}(this),h["finally"](i),1===this.listeners.length&&setImmediate(function(a){return function(){return a.active?a.run():void 0}}(this)),h},a.prototype.dump=function(){return[]},a.prototype.createEventQueue=function(a){return new b(a)},a.prototype.setActiveWindow=function(a){return a!==this.active?(this.active=a,this.active?this.run():void 0):void 0},a.prototype.expecting=function(){var a;return++this.expected,a=function(a){return function(){--a.expected,a.run()}}(this)},a.prototype.next=function(a){return++this.expected,setImmediate(function(b){return function(){var c;--b.expected;try{return a(),b.run()}catch(d){return c=d,b.emit("error",c)}}}(this))},a.prototype.run=function(){if(!this.running&&0!==this.listeners.length){if(!this.active)return void this.emit("done");this.running=!0,setImmediate(function(a){return function(){var b,c,d;if(a.running=!1,!a.active)return void a.emit("done");try{return(c=a.active._eventQueue.dequeue())?(c(),a.emit("tick",0),a.run()):a.expected>0?a.emit("tick",0):(d=a.active._eventQueue.next(),a.emit("tick",d),a.run())}catch(e){return b=e,a.emit("error",b)}}}(this))}},a.prototype.emit=function(a,b){var c,d,e,f,g;for(this.browser.emit(a,b),f=this.listeners,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c(a,b));return g},a}(),b=function(){function a(a){this.window=a,this.browser=this.window.browser,this.eventLoop=this.browser.eventLoop,this.timers=[],this.queue=[],this.expecting=[]}return a.prototype.destroy=function(){var a,b,c,d,e,f,g,h;for(g=this.timers,c=0,e=g.length;e>c;c++)b=g[c],b&&b.stop();for(h=this.expecting,d=0,f=h.length;f>d;d++)(a=h[d])();return this.timers=this.queue=this.expecting=null},a.prototype.enqueue=function(a){a&&this.queue&&(this.queue.push(a),this.eventLoop.run())},a.prototype.dequeue=function(){var a,b,c,d,e;if(this.queue){if(a=this.queue.shift())return a;for(e=this.window.frames,c=0,d=e.length;d>c;c++)if(b=e[c],a=b._eventQueue.dequeue())return a}},a.prototype.http=function(a,b,c,d){var e;this.queue&&(e=this.eventLoop.expecting(),this.expecting.push(e),this.browser.resources.request(a,b,c,function(a){return function(b,c){return a.queue?(a.enqueue(function(){return d(b,c)}),a.expecting.splice(a.expecting.indexOf(e),1),e()):void 0}}(this)))},a.prototype.onerror=function(a){var b;return this.window.console.error(a),this.browser.emit("error",a),b=this.window.document.createEvent("Event"),b.initEvent("error",!1,!1),b.message=a.message,b.error=a,this.window.dispatchEvent(b)},a.prototype.setTimeout=function(a,b){var c,d,f;return null==b&&(b=0),a?(c=this.timers.length,d=function(a){return function(){return delete a.timers[c]}}(this),f=new e(this,a,b,d),this.timers[c]=f,c+1):void 0},a.prototype.clearTimeout=function(a){var b,c;b=a-1,c=this.timers[b],c&&c.stop()},a.prototype.setInterval=function(a,b){var d,e,f;return null==b&&(b=0),a?(d=this.timers.length,e=function(a){return function(){return delete a.timers[d]}}(this),f=new c(this,a,b,e),this.timers[d]=f,d+1):void 0},a.prototype.clearInterval=function(a){var b,c;b=a-1,c=this.timers[b],c&&c.stop()},a.prototype.next=function(){var a,b,c,d,e,f,g,h,i,j;for(c=1/0,i=this.timers,e=0,g=i.length;g>e;e++)d=i[e],d&&d.next<c&&(c=d.next);for(j=this.window.frames,f=0,h=j.length;h>f;f++)a=j[f],b=a._eventQueue.next(),c>b&&(c=b);return c},a}(),e=function(){function a(a,b,c,d){var e;this.queue=a,this.fn=b,this.delay=c,this.remove=d,this.delay=Math.max(this.delay||0,0),e=function(a){return function(){return a.queue.enqueue(function(){return a.queue.browser.emit("timeout",a.fn,a.delay),a.queue.window._evaluate(a.fn)}),a.remove()}}(this),this.handle=global.setTimeout(e,this.delay),this.next=Date.now()+this.delay}return a.prototype.stop=function(){return global.clearTimeout(this.handle),this.remove()},a}(),c=function(){function a(a,b,c,d){var e,f;this.queue=a,this.fn=b,this.interval=c,this.remove=d,this.interval=Math.max(this.interval||0),f=!1,e=function(a){return function(){return a.next=Date.now()+a.interval,f?void 0:(f=!0,a.queue.enqueue(function(){return f=!1,a.queue.browser.emit("interval",a.fn,a.interval),a.queue.window._evaluate(a.fn)}))}}(this),this.handle=global.setInterval(e,this.interval),this.next=Date.now()+this.interval}return a.prototype.stop=function(){return global.clearInterval(this.handle),this.remove()},a}(),module.exports=a}.call(this),function(){var a,b,c,d,e;b=require("jsdom").dom.level3.html,d=require("path"),a=require("fs"),c=require("mime"),e=function(b){var e;return e=new String(d.basename(b)),e.filename=b,e.mime=c.lookup(b),e.read=function(){return a.readFileSync(b)},e},b.HTMLFormElement.prototype.submit=function(a){var b,c,d;return b=this.ownerDocument,c={},(d=function(f){return function(g){var h,i,j,k,l,m,n,o,p,q;if(h=f.elements.item(g)){if(l=null,!h.getAttribute("disabled")&&(i=h.getAttribute("name")))if("SELECT"===h.nodeName){for(k=[],p=h.options,m=0,n=p.length;n>m;m++)j=p[m],j.selected&&k.push(j.value);h.multiple?c[i]=(c[i]||[]).concat(k):(l=k.length>0?k[0]:null!=(q=h.options[0])?q.value:void 0,c[i]||(c[i]=[]),c[i].push(l))}else"INPUT"!==h.nodeName||"checkbox"!==h.type&&"radio"!==h.type?"INPUT"===h.nodeName&&"file"===h.type?h.value&&(c[i]||(c[i]=[]),c[i].push(e(h.value))):("TEXTAREA"===h.nodeName||"INPUT"===h.nodeName)&&"submit"!==h.type&&"image"!==h.type&&(c[i]||(c[i]=[]),c[i].push(h.value||"")):h.checked&&(c[i]||(c[i]=[]),c[i].push(h.value||"1"));return d(g+1)}return a&&a.name&&(c[o=a.name]||(c[o]=[]),c[a.name].push(a.value)),b.window._submit({url:f.getAttribute("action")||b.location.href,method:f.getAttribute("method")||"GET",encoding:f.getAttribute("enctype"),params:c,target:f.getAttribute("target")})}}(this))(0)},b.HTMLFormElement.prototype.reset=function(){var a,b,c,d,e,f;for(e=this.elements,f=[],c=0,d=e.length;d>c;c++)a=e[c],f.push("SELECT"===a.nodeName?function(){var c,d,e,f;for(e=a.options,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.selected=b._defaultSelected);return f}():"INPUT"!==a.nodeName||"checkbox"!==a.type&&"radio"!==a.type?"INPUT"===a.nodeName||"TEXTAREA"===a.nodeName?a.value=a._defaultValue:void 0:a.checked=!!a._defaultChecked);return f},b.HTMLFormElement.prototype._dispatchSubmitEvent=function(a){var b;return b=this.ownerDocument.createEvent("HTMLEvents"),b.initEvent("submit",!0,!0),b._button=a,this.dispatchEvent(b)},b.HTMLFormElement.prototype._eventDefaults.submit=function(a){return a.target.submit(a._button)},b.HTMLInputElement.prototype._eventDefaults={click:function(a){var b,c,d;switch(d=a.target,b=function(){return a=d.ownerDocument.createEvent("HTMLEvents"),a.initEvent("change",!0,!0),d.dispatchEvent(a)},d.type){case"reset":if(c=d.form)return c.reset();break;case"submit":case"image":if(c=d.form)return c._dispatchSubmitEvent(d);break;case"checkbox":return b();case"radio":if(!d.getAttribute("readonly"))return d.checked=!0,b()}}},b.HTMLInputElement.prototype.click=function(){var a,b,c,d,e,f,g,h,i;switch(this.focus(),b=function(a){return function(){var b,c;return c=a.ownerDocument.createEvent("HTMLEvents"),c.initEvent("click",!0,!0),b=a.dispatchEvent(c),!b}}(this),this.type){case"checkbox":this.getAttribute("readonly")||(c=this.checked,this.checked=!this.checked,b()||(this.checked=c));break;case"radio":if(!this.getAttribute("readonly"))if(this.checked)b();else{for(e=this.ownerDocument.querySelectorAll("input[type=radio][name='"+this.getAttribute("name")+"']",this.form),a=null,f=0,h=e.length;h>f;f++)d=e[f],d.checked&&(a=d,d.checked=!1);if(this.checked=!0,!b())for(this.checked=!1,g=0,i=e.length;i>g;g++)d=e[g],d.checked=d===a}break;default:b()}},b.HTMLButtonElement.prototype._eventDefaults={click:function(a){var b,c;if(b=a.target,b.getAttribute("disabled"));else if(c=b.form)return c._dispatchSubmitEvent(b)}},b.Document.prototype._elementBuilders.button=function(a,c){var d;return d=new b.HTMLButtonElement(a,c),d.type||(d.type="submit"),d}}.call(this),function(){var a,b,c,d,e,f,g,h,i;g=require("./window"),b=require("jsdom").dom.level3.html,d=require("url"),e=function(a,b){var d;return d=new c(a,b),d.open.bind(d)},i=function(a){return a.parent!==a.getGlobal()?a.parent:void 0},a=function(){function a(a,b,c){this.window=a,this.pushState=c,this.url=d.format(b),this.next=this.prev=null}return a.prototype.destroy=function(a){return this.next&&(this.next.destroy(a||this.window),this.next=null),a===this.window||this.prev&&this.prev.window===this.window?void 0:this.window._destroy()},a.prototype.append=function(a,b){return this.next&&this.next.destroy(b),a.prev=this,this.next=a},a}(),c=function(){function c(a,b){this.browser=a,this.focus=b,this.first=this.current=null}return c.prototype.open=function(a){var b;return a.browser=this.browser,a.history=this,b=g(a),this.addEntry(b,a.url),b},c.prototype.destroy=function(){var a;return this.focus(null),a=this.first,this.first=this.current=null,a?a.destroy():void 0},c.prototype.addEntry=function(b,c,d){var e;return c||(c=b.location.href),e=new a(b,c,d),this.updateLocation(b,c),this.focus(b),this.current?(this.current.append(e),this.current=e):this.current=this.first=e},c.prototype.replaceEntry=function(b,c,d){var e;return c||(c=b.location.href),e=new a(b,c,d),this.updateLocation(b,c),this.focus(b),this.current===this.first?(this.current&&this.current.destroy(b),this.current=this.first=e):(this.current.prev.append(e,b),this.current=e)},c.prototype.updateLocation=function(a,b){var c;return c=this,Object.defineProperty(a,"location",{get:function(){return f(c,b)},set:function(a){return c.assign(a)},enumerable:!0})},c.prototype.submit=function(a){var b,c;return a.browser=this.browser,a.history=this,(c=this.current.window)&&(a.name=c.name,a.parent=i(c),a.referer=c.URL),b=g(a),this.addEntry(b,a.url)},c.prototype.__defineGetter__("url",function(){var a;return null!=(a=this.current)?a.url:void 0}),c.prototype.assign=function(a){var c,d,e,f;return this.current&&(a=b.resourceLoader.resolve(this.current.window.document,a),d=this.current.window.name,e=i(this.current.window)),this.current&&this.current.url===a?void this.replace(a):void(h(this.current,a)?(f=this.current.window,this.addEntry(f,a),c=f.document.createEvent("HTMLEvents"),c.initEvent("hashchange",!0,!1),f._eventQueue.enqueue(function(){return f.dispatchEvent(c)})):(f=g({browser:this.browser,history:this,name:d,url:a,parent:e}),this.addEntry(f,a)))},c.prototype.replace=function(a){var c,e,f;a=d.format(a),this.current&&(a=b.resourceLoader.resolve(this.current.window.document,a),e=this.current.window.name),h(this.current,a)?(f=this.current.window,this.replaceEntry(f,a),c=f.document.createEvent("HTMLEvents"),c.initEvent("hashchange",!0,!1),f._eventQueue.enqueue(function(){return f.dispatchEvent(c)})):(f=g({browser:this.browser,history:this,name:e,url:a,parent:i(this.current.window)}),this.replaceEntry(f,a))},c.prototype.reload=function(){var a,b,c;return(c=this.current.window)?(b=c.location.href,a=g({browser:this.browser,history:this,name:c.name,url:b},{parent:i(c),referer:c.referrer}),this.replaceEntry(a,b)):void 0},c.prototype.go=function(a){var b,c,e,f,g;for(f=this.current;a>0;)this.current.next&&(this.current=this.current.next),--a;for(;0>a;)this.current.prev&&(this.current=this.current.prev),++a;this.current&&f&&this.current!==f&&(g=this.current.window,this.updateLocation(g,this.current.url),this.focus(g),this.current.pushState||f.pushState?(e=d.parse(f.url).host,c=d.parse(this.current.url).host,e===c&&(b=g.document.createEvent("HTMLEvents"),b.initEvent("popstate",!1,!1),b.state=this.current.pushState,g._eventQueue.enqueue(function(){return g.dispatchEvent(b)}))):h(f,this.current.url)&&(b=g.document.createEvent("HTMLEvents"),b.initEvent("hashchange",!0,!1),g._eventQueue.enqueue(function(){return g.dispatchEvent(b)})))},c.prototype.__defineGetter__("length",function(){var a,b;for(a=this.first,b=0;a;)++b,a=a.next;return b}),c.prototype.pushState=function(a,c,d){d||(d=this.current.window.location.href),d=b.resourceLoader.resolve(this.current.window.document,d),this.addEntry(this.current.window,d,a||{})},c.prototype.replaceState=function(a,c,d){d||(d=this.current.window.location.href),d=b.resourceLoader.resolve(this.current.window.document,d),this.replaceEntry(this.current.window,d,a||{})},c.prototype.__defineGetter__("state",function(){return this.current.pushState?this.current.pushState:void 0}),c.prototype.dump=function(){var a,b,c,e;return a=this.first,c=1,b=function(){var b;for(b=[];a;)e=a.next?"#"+c+": ":c+". ",e+=d.format(a.url),a=a.next,++c,b.push(e);return b}()},c}(),h=function(a,b){var c,d,e,f,g,h;return a?(g=b.split("#"),c=g[0],d=g[1],h=a.url.split("#"),e=h[0],f=h[1],c===e&&d!==f):!1},f=function(a,b){var c,e,f,g,h,i;for(c=new Object,Object.defineProperties(c,{assign:{value:function(b){return a.assign(b)}},replace:{value:function(b){return a.replace(b)}},reload:{value:function(){return a.reload()}},toString:{value:function(){return b},enumerable:!0},hostname:{get:function(){return d.parse(b).hostname},set:function(c){var e;return e=d.parse(b),e.host=e.port?""+c+":"+e.port:c,a.assign(d.format(e))},enumerable:!0},href:{get:function(){return b},set:function(b){return a.assign(d.format(b))},enumerable:!0}}),i=["hash","host","pathname","port","protocol","search"],f=function(){return function(e){return Object.defineProperty(c,e,{get:function(){return d.parse(b)[e]||""},set:function(c){var f;return f=d.parse(b),f[e]=c,a.assign(d.format(f))},enumerable:!0})}}(this),g=0,h=i.length;h>g;g++)e=i[g],f(e);return c},module.exports=e}.call(this),function(){var a,b,c,d,e,f;a=require("./assert"),d=require("./resources"),b=require("./browser"),c=require("path"),f=function(a,c,d){var e,f;return 2===arguments.length&&(f=[null,c],c=f[0],d=f[1]),e=b.create(c),d?e.visit(a,c,function(a){return d(a,e)}):e.visit(a,c).then(function(){return e})},e=function(a,b){return require("./zombie/protocol").listen(a,b)},b.listen=e,b.visit=f,b.Assert=a,b.Resources=d,b.debug=!!process.env.DEBUG,module.exports=b}.call(this),function(){var a;a=function(){function a(a){var b,c,d,e,f,g;g=[],b=[],this.onalert=function(a){return b.push(a)},d=[],c={},this.onconfirm=function(a,b){return"function"==typeof a?d.push(a):c[a]=!!b},f=[],e={},this.onprompt=function(a,b){return"function"==typeof a?f.push(a):e[a]=b},this.prompted=function(a){return g.indexOf(a)>=0},this.extend=function(h){return h.alert=function(c){var d,e,f;for(a.emit("alert",c),g.push(c),e=0,f=b.length;f>e;e++)(d=b[e])(c)},h.confirm=function(b){var e,f,h,i;if(a.emit("confirm",b),g.push(b),f=c[b],!f&&f!==!1)for(h=0,i=d.length;i>h&&(e=d[h],f=e(b),!f&&f!==!1);h++);return!!f},h.prompt=function(b,c){var d,h,i,j;if(a.emit("prompt",b),g.push(b),h=e[b],!h&&h!==!1)for(i=0,j=f.length;j>i&&(d=f[i],h=d(b,c),!h&&h!==!1);i++);return h?h.toString():h===!1?null:c||""}}}return a}(),exports.use=function(b){return new a(b)}}.call(this),function(){var a,b,c,d,e;for(a=require("jsdom").dom.level3.html,a.HTMLDocument.prototype.__defineGetter__("scripts",function(){return new a.HTMLCollection(this,function(a){return function(){return a.querySelectorAll("script")}}(this))}),a.HTMLElement.prototype.__defineGetter__("offsetLeft",function(){return 0}),a.HTMLElement.prototype.__defineGetter__("offsetTop",function(){return 0}),a.HTMLScriptElement.prototype.__defineGetter__("src",function(){return this.getAttribute("src")||""}),a.HTMLElement.prototype.__defineGetter__("id",function(){return this.getAttribute("id")||""}),e=[a.HTMLInputElement,a.HTMLButtonElement,a.HTMLParamElement],c=0,d=e.length;d>c;c++)b=e[c],b.prototype.__defineGetter__("value",function(){return this.getAttribute("value")||""});a.HTMLAnchorElement.prototype._eventDefaults={click:function(a){var b,c,d;if(b=a.target,b.href){switch(d=b.ownerDocument.window,c=d.browser,b.target||"_self"){case"_self":d.location=b.href;break;case"_parent":d.parent.location=b.href;break;case"_top":d.top.location=b.href;break;default:c.tabs.open({name:b.target,url:b.href})}return c.emit("link",b.href,b.target||"_self")}}},Object.defineProperty(a.CSSStyleDeclaration.prototype,"opacity",{get:function(){var a;return a=this.getPropertyValue("opacity"),Number.isFinite(a)?a.toString():""},set:function(a){return null===a||void 0===a||""===a?this.removeProperty("opacity"):(a=parseFloat(a),isFinite(a)?this.setProperty("opacity",a):void 0)}}),["height","width"].forEach(function(b){var c,d;return c="client"+b[0].toUpperCase()+b.slice(1),d="offset"+b[0].toUpperCase()+b.slice(1),Object.defineProperty(a.HTMLElement.prototype,c,{get:function(){var a;return a=parseInt(this.style.getPropertyValue(b),10),Number.isFinite(a)?a:100}}),Object.defineProperty(a.HTMLElement.prototype,d,{get:function(){return 0}})}),a.HTMLImageElement.prototype._attrModified=function(b,c,d){return"src"===b&&c!==d?a.resourceLoader.load(this,c):void 0},a.HTMLElement.prototype.insertAdjacentHTML=function(a,b){var c,d,e,f,g,h,i,j,k;switch(c=this.ownerDocument.createElementNS("http://www.w3.org/1999/xhtml","_"),g=this.parentNode,c.innerHTML=b,a.toLowerCase()){case"beforebegin":for(h=[];f=c.firstChild;)h.push(g.insertBefore(f,this));return h;case"afterbegin":for(d=this.firstChild,i=[];f=c.lastChild;)i.push(d=this.insertBefore(f,d));return i;case"beforeend":for(j=[];f=c.firstChild;)j.push(this.appendChild(f));return j;case"afterend":for(e=this.nextSibling,k=[];f=c.lastChild;)k.push(e=g.insertBefore(f,e));return k}},a.Node.prototype.contains=function(a){return!!(16&this.compareDocumentPosition(a))}}.call(this),function(){var a,b;a=require("http"),b=function(){function b(){this._ports={},this._http=a.request,a.request=this._request.bind(this)}return b.prototype.map=function(a,b){return this._ports[a]=b},b.prototype.unmap=function(){return delete this._ports.hostname},b.prototype._request=function(a,b){var c,d,e;return c=a.hostname||a.host&&a.host.split(":")[0]||"localhost",e=a.port||a.host&&a.host.split(":")[1]||80,80===e&&(d=this._find(c),d&&(a=Object.create(a),a.hostname=c,a.port=d)),this._http(a,b)},b.prototype._find=function(a){var b,c,d,e,f;for(d=a.split("."),b=[a,"*."+a],c=e=1,f=d.length;f>=1?f>e:e>f;c=f>=1?++e:--e)b.push("*."+d.slice(c,+d.length+1||9e9).join("."));return b.map(function(a){return function(b){return a._ports[b]}}(this)).filter(function(a){return a})[0]},b}(),module.exports=b}.call(this),function(){var a,b,c,d,e,f,g,h;h=require("net"),c=-1,g=0,d=1,a=2,e=3,b=function(){function b(b,f){var h,i,j,k,l,m,n;this.stream=b,this.debug=f,this.reset(),h=0,i=0,j=[],k="",l=null,this.process=function(a){if(a&&(k+=a),h)if(i){if(k.length>=i&&(j.push(k.slice(0,i)),k=k.slice(i),i=0,j.length===h&&(m(j),h=0,j=[]),k.length>0))return this.process()}else{if(k=k.replace(/^\$(\d+)\r\n/,function(a){return function(b,c){return i=parseInt(c,10),a.debug&&console.log("Expecting argument of size "+i),""}}(this)),i)return this.process();if(k.length>0&&"$"!==k[0])throw new Error("Expecting $<argc>CRLF")}else{if(k=k.replace(/^\*(\d+)\r\n/,function(a){return function(b,c){return h=parseInt(c,10),a.debug&&console.log("Expecting "+h+" arguments"),""}}(this)),h)return this.process();if(k.length>0&&"*"!==k[0])throw new Error("Expecting *<argc>CRLF")}},m=function(a){return function(b){var d;return d={},d.invoke=function(){var e,g;try{return(g=a[b[0].toLowerCase()])?(f&&console.log("Executing "+b.join(" ")),b[0]=d.reply,g.apply(a,b)):d.reply(c,"Unknown command "+b[0])}catch(h){return e=h,d.reply(c,"Failed on "+b[0]+": "+e.message)}},d.reply=function(b,c){return n(a.stream,b,c),l===d&&(l=d.next),d.next?process.nextTick(function(){return d.next.invoke()}):void 0},l?(l.next=d,l=d):(l=d,d.invoke())}}(this),n=function(b,f,h){var i,j,k,l;switch(f){case c:return b.write("-"+h.message+"\r\n");case g:return b.write("+"+h+"\r\n");case d:return b.write(":"+h+"\r\n");case a:return h?(b.write("$"+h.length+"\r\n"),b.write(h),b.write("\r\n")):b.write("$-1\r\n");case e:if(h){for(b.write("*"+h.length+"\r\n"),l=[],j=0,k=h.length;k>j;j++)i=h[j],i?(b.write("$"+i.length+"\r\n"),b.write(i),l.push(b.write("\r\n"))):l.push(b.write("$-1\r\n"));return l}return b.write("*-1\r\n")}}}return b.prototype.debug=function(a,b){return this.browser.debug="0"===b||"off"===b},b.prototype.echo=function(a,b){return a(g,b)},b.prototype.reset=function(a){return this.browser=new module.parent.exports.Browser({debug:this.debug}),a?a(g,"OK"):void 0},b.prototype.status=function(a){return a(d,this.browser.statusCode||0)},b.prototype.visit=function(a,b){return this.browser.visit(b),a(g,"OK")},b.prototype.wait=function(a){return this.browser.wait(function(b){return b?a(c,b.message):a(g,"OK")})},b}(),f=function(){function a(a){var c,d,e;d=!1,e=h.createServer(function(a){var c;return a.setNoDelay(!0),c=new b(a,d),a.on("data",function(a){return c.process(a)})}),c=!1,a||(a=8091),this.listen=function(b){var d;return d=function(a){return a||(c=!0),b?b(a):void 0},"number"==typeof a?e.listen(a,"127.0.0.1",d):e.listen(a,d)},this.close=function(){return c?(e.close(),c=!1):void 0},this.__defineGetter__("active",function(){return c})}return a}(),exports.Protocol=f,exports.listen=function(a,b){var c,d;return b||(d=[8091,a],a=d[0],b=d[1]),c=new f(a),c.listen(b)}}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l={}.hasOwnProperty,m=function(a,b){function c(){this.constructor=a}for(var d in b)l.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},n=[].slice;k=require("encoding"),a=require("fs"),b=require("jsdom").dom.level3.html,d=require("path"),e=require("querystring"),f=require("request"),h=require("url"),c=require("http"),i=require("zlib"),j=require("assert"),g=function(a){function d(a){this.browser=a,this.pipeline=d.pipeline.slice(),this.urlMatchers=[]}return m(d,a),d.prototype.request=function(a,b,d,e){var f,g,h,i;return null==d&&(d={}),e||"function"!=typeof d||(i=[{},d],d=i[0],e=i[1]),g={method:a.toUpperCase(),url:b,headers:d.headers||{},params:d.params,body:d.body,time:Date.now(),timeout:d.timeout||0,strictSSL:this.browser.strictSSL},h={request:g,target:d.target},this.push(h),this.browser.emit("request",g),f=new Promise(function(a){return function(b,d){return a.runPipeline(g,function(e,f){return e?(h.error=e,d(e)):(f.url||(f.url=g.url),f.statusCode||(f.statusCode=200),f.statusText=c.STATUS_CODES[f.statusCode]||"Unknown",f.headers||(f.headers={}),f.redirects||(f.redirects=0),f.time=Date.now(),h.response=f,a.browser.emit("response",g,f),b(h.response))})}}(this)),e?f.then(function(a){return e(null,a)},e):f},d.prototype.get=function(a,b,c){return this.request("get",a,b,c)},d.prototype.post=function(a,b,c){return this.request("post",a,b,c)},d.prototype.fail=function(a,b){var c;c=function(a,c){return c(new Error(b||"This request was intended to fail"))},this.urlMatchers.push([a,c])},d.prototype.delay=function(a,b){var c;null==b&&(b=10),c=function(a,c){return setTimeout(c,b)},this.urlMatchers.push([a,c])},d.prototype.mock=function(a,b){var c;null==b&&(b={}),c=function(a,c){return c(null,b)},this.urlMatchers.push([a,c])},d.prototype.restore=function(a){this.urlMatchers=this.urlMatchers.filter(function(b){var c,d;return c=b[0],d=b[1],c!==a})},d.prototype.dump=function(a){var c,d,e,f,g,h,i,j,k,l,m,n;for(null==a&&(a=process.stdout),n=[],k=0,l=this.length;l>k;k++){if(f=this[k],e=f.request,g=f.response,c=f.error,i=f.target,a.write(g?""+e.method+" "+g.url+" - "+g.statusCode+" "+g.statusText+" - "+(g.time-e.time)+"ms\n":""+f.request.method+" "+f.request.url+"\n"),i instanceof b.Document?a.write("  Loaded as HTML document\n"):i&&a.write(i.id?"  Loading by element #"+i.id+"\n":"  Loading as "+i.tagName+" element\n"),g){g.redirects&&a.write("  Followed "+g.redirects+" redirects\n"),m=g.headers;for(d in m)j=m[d],a.write("  "+d+": "+j+"\n");a.write("\n"),h=g.body.slice(0,250).toString("utf8").split("\n").map(function(a){return"  "+a}).join("\n"),a.write(h)}else a.write(c?"  Error: "+c.message+"\n":"  Pending since "+new Date(e.time)+"\n");n.push(a.write("\n\n"))}return n},d.prototype.addHandler=function(a){return j(a.call,"Handler must be a function"),j(2===a.length||3===a.length,"Handler function takes 2 (request handler) or 3 (reponse handler) arguments"),this.pipeline.push(a)},d.prototype.runPipeline=function(a,b){var c,e,f,g,h;f=this.pipeline.filter(function(a){return 2===a.length}),f.push(d.makeHTTPRequest),h=this.pipeline.filter(function(a){return 3===a.length}),g=null,c=function(d){return function(h,i){var j;if(h)return b(h);if(i)return g=i,g.url||(g.url=a.url),e();j=f.shift();try{return j.call(d.browser,a,c)}catch(k){return h=k,b(h)}}}(this),e=function(c){return function(d){var f;if(d)return b(d);if(f=h.shift(),!f)return b(null,g);try{return f.call(c.browser,a,g,e)}catch(i){return d=i,b(d)}}}(this),c()},d}(Array),g.addHandler=function(a){return j(a.call,"Handler must be a function"),j(2===a.length||3===a.length,"Handler function takes 2 (request handler) or 3 (response handler) arguments"),this.pipeline.push(a)},g.normalizeURL=function(a,c){var d,e,f,g,i;if(a.url=/^file:/.test(a.url)?a.url.replace(/^file:\/{1,3}/,"file:///"):this.document?b.resourceLoader.resolve(this.document,a.url):h.resolve(this.site||"http://localhost",a.url),a.params&&(d=a.method,"GET"===d||"HEAD"===d||"DELETE"===d)){f=h.parse(a.url,!0),i=a.params;for(e in i)g=i[e],f.query[e]=g;a.url=h.format(f)}c()},g.mergeHeaders=function(a,b){var c,d,e,f,g,i,j;d={"user-agent":this.userAgent},i=this.headers;for(f in i)g=i[f],d[f.toLowerCase()]=g;if(a.headers){j=a.headers;for(f in j)g=j[f],d[f.toLowerCase()]=g}e=h.parse(a.url).host,d.host=e,(c=this.authenticate(e,!1))&&c.apply(d),a.headers=d,b()},g.createBody=function(a,b){var c,d,f,g,h,i,j,k,l,m,n,o,p;if(h=a.method,("POST"===h||"PUT"===h)&&(g=a.headers,g["content-type"]||(g["content-type"]="application/x-www-form-urlencoded"),i=g["content-type"].split(";")[0],!a.body))switch(i){case"application/x-www-form-urlencoded":a.body=e.stringify(a.params||{}),g["content-length"]=a.body.length;break;case"multipart/form-data":if(l=a.params||{},0===Object.keys(l).length)g["content-type"]="text/plain",a.body="";else{d=""+(new Date).getTime()+"."+Math.random(),g["content-type"]+="; boundary="+d,j=[];for(k in l)for(n=l[k],o=0,p=n.length;p>o;o++)m=n[o],f='form-data; name="'+k+'"',m.read?(c=m.read(),j.push({"Content-Disposition":""+f+'; filename="'+m+'"',"Content-Type":m.mime||"application/octet-stream","Content-Length":c.length,body:c})):j.push({"Content-Disposition":f,"Content-Type":"text/plain; charset=utf8","Content-Length":m.length,body:m});a.multipart=j}break;case"text/plain":break;default:return void b(new Error("Unsupported content type "+i))}b()},g.specialURLHandlers=function(a,b){var c,d,e,f,g,i;for(g=this.resources.urlMatchers,e=0,f=g.length;f>e;e++)if(i=g[e],d=i[0],c=i[1],h.resolve(a.url,d)===a.url)return void c(a,b);return b()},g.decompressBody=function(a,b,c){var d,e;switch(b.body&&b.headers&&(e=b.headers["transfer-encoding"],d=b.headers["content-encoding"]),e||d){case"deflate":i.inflate(b.body,function(a,d){return a||(b.body=d),c(a)});break;case"gzip":i.gunzip(b.body,function(a,d){return a||(b.body=d),c(a)});break;default:c()}},g.decodeBody=function(a,b,c){var d,e,f,g,h,i,j,l,m,o,p;if(b.body&&b.headers&&(e=b.headers["content-type"]),e&&(o=e.split(/;\s*/),f=o[0],j=2<=o.length?n.call(o,1):[],p=e.split(/\//,2),h=p[0],g=p[1],"application/octet-stream"!==f&&"image"!==h)){for(l=0,m=j.length;m>l;l++)if(i=j[l],/^charset=/.test(i)){d=i.split("=")[1];break}b.body=k.convert(b.body.toString(),null,d||"utf-8").toString()}c()},g.pipeline=[g.normalizeURL,g.mergeHeaders,g.createBody,g.specialURLHandlers,g.decompressBody,g.decodeBody],g.makeHTTPRequest=function(b,c){var e,g,i,j,k,l,m;m=h.parse(b.url),l=m.protocol,i=m.hostname,k=m.pathname,"file:"===l?"GET"===b.method?(g=d.normalize(decodeURI(k)),a.exists(g,function(){return function(b){return b?a.readFile(g,function(a,b){return a?(resource.error=a,c(a)):c(null,{body:b})}):c(null,{statusCode:404})}}(this))):c(resource.error):(e=this.cookies,b.headers.cookie=e.serialize(i,k),j={method:b.method,url:b.url,headers:b.headers,body:b.body,multipart:b.multipart,proxy:this.proxy,jar:!1,followRedirect:!1,encoding:null,strictSSL:b.strictSSL,timeout:b.timeout||0},f(j,function(a){return function(d,f){var g,j,l,m,n,o,p;if(d)return void c(d);switch(n=f.headers["set-cookie"],n&&e.update(n,i,k),m=b.redirects||0,f.statusCode){case 301:case 307:("GET"===b.method||"HEAD"===b.method)&&(f.url=h.resolve(b.url,f.headers.location));break;case 302:case 303:f.url=h.resolve(b.url,f.headers.location)}if(f.url){if(++m,m>a.maxRedirects)return void c(new Error("More than "+a.maxRedirects+" redirects, giving up"));j={},p=b.headers;for(g in p)o=p[g],j[g]=o;return j.referer=b.url,delete j["content-type"],delete j["content-length"],delete j["content-transfer-encoding"],l={method:"GET",url:f.url,headers:j,redirects:m,strictSSL:b.strictSSL,time:b.time,timeout:b.timeout},a.emit("redirect",f,l),a.resources.runPipeline(l,c)
}return f={url:b.url,statusCode:f.statusCode,headers:f.headers,body:f.body,redirects:m},c(null,f)}}(this)))},module.exports=g}.call(this),function(){var a,b,c,d,e;b=require("jsdom").dom.level3.html,c=require("url");try{a=require("coffee-script"),b.languageProcessors.coffeescript=function(b,c,d){return this.javascript(b,a.compile(c),d)}}catch(f){d=f}b.languageProcessors.javascript=function(a,b,c){var d,f,g,h;if(b){f=a.ownerDocument,h=f.window;try{return h._evaluate(b,c)}catch(i){return g=i,g instanceof Error||(d=new Error(g.message),d.stack=g.stack,g=d),e({element:a,location:c,from:__filename,error:g})}}},b.HTMLScriptElement._init=function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(){var a,c,d;return this.src?b.resourceLoader.load(this,this.src,this._eval):(d=this.id?""+this.ownerDocument.URL+":#"+id:""+this.ownerDocument.URL+":script",c=function(a){return function(){return a._eval(a.textContent,d)}}(this),a=b.resourceLoader.enqueue(this,c,d),"loading"===this.ownerDocument.readyState?process.nextTick(a):a())})},b.resourceLoader.load=function(a,c,d){var e,f,g,h,i,j;return e=a.ownerDocument,j=e.parentWindow,g=e.implementation,h=a.tagName.toLowerCase(),g.hasFeature("FetchExternalResources",h)?(f=function(b){return d.call(a,b.body.toString(),i.pathname)},i=b.resourceLoader.resolve(e,c),j._eventQueue.http("GET",i,{target:a},this.enqueue(a,f,i))):void 0},module.exports=e=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;if(c=a.element,f=a.location,i=a.scope,d=a.error,b=c.ownerDocument||c,j=b.parentWindow,g=i?""+i+": "+d.message:d.message,f||(f=b.location.href),h=[],d.stack)for(m=d.stack.split("\n"),k=0,l=m.length;l>k&&(e=m[k],!~e.indexOf("contextify/lib/contextify.js"));k++)h.push(e);h.push("    in "+f),d.stack=h.join("\n"),j._eventQueue.onerror(d)}}.call(this),function(){var a,b,c,d,e,f;b=require("jsdom").dom.level3.html,a=require("jsdom").dom.level3.events.Event,d=function(){function a(){this._items=[],this._storages=[]}return a.prototype._fire=function(a,b,c,d){var f,g,h,i,j,k,l,m;for(k=this._storages,m=[],i=0,j=k.length;j>i;i++)l=k[i],g=l[0],h=l[1],g!==a&&(f=new e(g,h.location.href,b,c,d),m.push(h.dispatchEvent(f)));return m},a.prototype.__defineGetter__("length",function(){var a,b;a=0;for(b in this._items)++a;return a}),a.prototype.key=function(a){var b,c;b=0;for(c in this._items){if(b===a)return c;++b}},a.prototype.get=function(a){return this._items[a]||null},a.prototype.set=function(a,b,c){var d;return d=this._items[b],this._items[b]=c,this._fire(a,b,d,c)},a.prototype.remove=function(a,b){var c;return c=this._items[b],delete this._items[b],this._fire(a,b,c)},a.prototype.clear=function(a){return this._items=[],this._fire(a)},a.prototype.associate=function(a,b){return this._storages.push([a,b])},a.prototype.__defineGetter__("pairs",function(){var a,b;return function(){var c,d;c=this._items,d=[];for(a in c)b=c[a],d.push([a,b]);return d}.call(this)}),a.prototype.toString=function(){var a,b;return function(){var c,d;c=this._items,d=[];for(a in c)b=c[a],d.push(""+a+" = "+b);return d}.call(this).join("\n")},a}(),c=function(){function a(a){this._area=a}return a.prototype.__defineGetter__("length",function(){return this._area.length}),a.prototype.key=function(a){return this._area.key(a)},a.prototype.getItem=function(a){return this._area.get(a.toString())},a.prototype.setItem=function(a,b){return this._area.set(this,a.toString(),b)},a.prototype.removeItem=function(a){return this._area.remove(this,a.toString())},a.prototype.clear=function(){return this._area.clear(this)},a.prototype.dump=function(){return this._area.dump()},a}(),e=function(b,c,d,e,f){return a.call(this,"storage"),this.__defineGetter__("url",function(){return c}),this.__defineGetter__("storageArea",function(){return b}),this.__defineGetter__("key",function(){return d}),this.__defineGetter__("oldValue",function(){return e}),this.__defineGetter__("newValue",function(){return f})},e.prototype.__proto__=a.prototype,b.SECURITY_ERR=18,f=function(){function a(){this._locals={},this._sessions={}}return a.prototype.local=function(a){var b,e;return b=null!=(e=this._locals)[a]?e[a]:e[a]=new d,new c(b)},a.prototype.session=function(a){var b,e;return b=null!=(e=this._sessions)[a]?e[a]:e[a]=new d,new c(b)},a.prototype.extend=function(a){var b;return b=this,a.StorageEvent=e,Object.defineProperty(a,"localStorage",{get:function(){var a;return null!=(a=this.document)?a._localStorage||(a._localStorage=b.local(this.location.host)):void 0}}),Object.defineProperty(a,"sessionStorage",{get:function(){var a;return null!=(a=this.document)?a._sessionStorage||(a._sessionStorage=b.session(this.location.host)):void 0}})},a.prototype.dump=function(){var a,b,c,d,e,f,g,h,i,j,k;e=[],j=this._locals;for(b in j)for(a=j[b],d=a.pairs,e.push(""+b+" local:"),f=0,h=d.length;h>f;f++)c=d[f],e.push("  "+c[0]+" = "+c[1]);k=this._sessions;for(b in k)for(a=k[b],d=a.pairs,e.push(""+b+" session:"),g=0,i=d.length;i>g;g++)c=d[g],e.push("  "+c[0]+" = "+c[1]);return e},a.prototype.save=function(){var a,b,c,d,e,f,g,h,i,j,k;e=["# Saved on "+(new Date).toISOString()],j=this._locals;for(b in j)if(a=j[b],d=a.pairs,d.length>0)for(e.push(""+b+" local:"),f=0,h=d.length;h>f;f++)c=d[f],e.push("  "+escape(c[0])+" = "+escape(c[1]));k=this._sessions;for(b in k)if(a=k[b],d=a.pairs,d.length>0)for(e.push(""+b+" session:"),g=0,i=d.length;i>g;g++)c=d[g],e.push("  "+escape(c[0])+" = "+escape(c[1]));return e.join("\n")+"\n"},a.prototype.load=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;for(e=null,j=a.split(/\n+/),m=[],h=0,i=j.length;i>h;h++)if(c=j[h],"#"!==c[0]&&""!==c)if(" "===c[0]){if(k=c.split("="),d=k[0],g=k[1],!e)throw"Must specify storage type using local: or session:";m.push(e.setItem(unescape(d.trim()),unescape(g.trim())))}else if(l=c.split(" "),b=l[0],f=l[1],"local:"===f)m.push(e=this.local(b));else{if("session:"!==f)throw"Unkown storage type "+f;m.push(e=this.session(b))}return m},a}(),module.exports=f}.call(this),function(){var a,b;a=require("./history"),b=function(b){var c,d;return d=[],c=null,Object.defineProperties(d,{current:{get:function(){return c},set:function(a){a=d.find(a)||a,~d.indexOf(a)&&a&&a!==c&&(c&&b.emit("inactive",c),c=a,b.emit("active",c))}},dump:{value:function(a){var b,c,e,f;if(null==a&&(a=process.stdout),0===d.length)return a.write("No open tabs.\n");for(f=[],c=0,e=d.length;e>c;c++)b=d[c],f.push(a.write("Window "+(b.name||"unnamed")+" open to "+b.location.href+"\n"));return f}},open:{value:function(e){var f,g,h,i,j,k;return null==e&&(e={}),h=e.name,j=e.url,h&&(k=this.find(h.toString()))?(d.current=k,j&&(k.location=j),c):("_blank"!==h&&h||(h=""),f=null,g=function(a){var c;return a&&a!==f&&(c=d.indexOf(f),~c&&(d[c]=a),d.current===f&&(d.current=a),f=a),b.eventLoop.setActiveWindow(a)},i=a(b,g),e.url=j,k=i(e),this.push(k),!h||!Object.propertyIsEnumerable(h)&&this[h]||(this[h]=k),f=k,d.current=k,k)}},index:{get:function(){return this.indexOf(c)}},find:{value:function(a){var b,c,e;if(d.propertyIsEnumerable(a))return d[a];for(c=0,e=this.length;e>c;c++)if(b=this[c],b.name===a)return b;return null}},close:{value:function(a){a=0===arguments.length?c:this.find(a)||a,~this.indexOf(a)&&a.close()}},closeAll:{value:function(){var a,b,c,d,e;for(b=this.slice(0),e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(a.close?a.close():void 0);return e}}}),b.on("closed",function(a){var e;return e=d.indexOf(a),~e&&(b.emit("inactive",a),d.splice(e,1),d.propertyIsEnumerable(a.name)&&delete d[a.name],a===c&&(c=e>0?d[e-1]:d[0]))?b.emit("active",c):void 0}),d},module.exports=b}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;k=require("./document"),a=require("eventsource"),e=require("./history"),f=require("jsdom"),i=require("ws"),h=require("url"),j=require("./xhr"),b=f.dom.level3.events,d=f.dom.level3.html,module.exports=l=function(e){var l,m,o,p,q,r,s,t,u,v,w,x,y,z,A,B;return l=e.browser,w=e.params,p=e.encoding,s=e.history,t=e.method,u=e.name,v=e.opener,x=e.parent,y=e.referer,z=e.url,u||(u=""),z||(z="about:blank"),A=f.createWindow(d),r=A.getGlobal(),m=!1,Object.defineProperty(A,"browser",{value:l,enumerable:!0}),o=k(l,A,y||s.url),Object.defineProperty(A,"document",{value:o,enumerable:!0}),Object.defineProperty(A,"name",{value:u,enumerable:!0}),x?(Object.defineProperty(A,"parent",{value:x,enumerable:!0}),Object.defineProperty(A,"top",{value:x.top,enumerable:!0})):(Object.defineProperty(A,"parent",{value:r,enumerable:!0}),Object.defineProperty(A,"top",{value:r,enumerable:!0})),Object.defineProperty(A,"opener",{value:v&&v,enumerable:!0}),Object.defineProperty(A,"title",{get:function(){return o.title},set:function(a){return o.title=a},enumerable:!0}),Object.defineProperty(A,"console",{value:l.console,enumerable:!0}),Object.defineProperties(A.navigator,{cookieEnabled:{value:!0},javaEnabled:{value:function(){return!1}},plugins:{value:[]},userAgent:{value:l.userAgent},language:{value:l.language},vendor:{value:"Zombie Industries"}}),Object.defineProperty(A,"cookies",{get:function(){return l.cookies(this.location.hostname,this.location.pathname)}}),l._storages.extend(A),l._interact.extend(A),Object.defineProperties(A,{File:{value:c},Event:{value:b.Event},screen:{value:new g},MouseEvent:{value:b.MouseEvent},MutationEvent:{value:b.MutationEvent},UIEvent:{value:b.UIEvent}}),A.atob=function(a){return new Buffer(a,"base64").toString("utf8")},A.btoa=function(a){return new Buffer(a,"utf8").toString("base64")},A.XMLHttpRequest=function(){return new j(A)},A.EventSource=function(b){return b=d.resourceLoader.resolve(o,b),A.setInterval(function(){},100),new a(b)},A.WebSocket=function(a,b){var c;return a=d.resourceLoader.resolve(o,a),c=""+A.location.protocol+"//"+A.location.host,new i(a,{origin:c,protocol:b})},A.Image=function(a,b){var c;return c=new d.HTMLImageElement(A.document),c.width=a,c.height=b,c},A.resizeTo=function(a,b){return A.outerWidth=A.innerWidth=a,A.outerHeight=A.innerHeight=b},A.resizeBy=function(a,b){return A.resizeTo(A.outerWidth+a,A.outerHeight+b)},A.onhashchange=null,A.postMessage=function(a){var b,c;return o=A.document,b=o.createEvent("MessageEvent"),b.initEvent("message",!1,!1),b.data=a,b.source=(l._windowInScope||A).getGlobal(),c=b.source.location,b.origin=h.format({protocol:c.protocol,host:c.host}),A.dispatchEvent(b)},A._evaluate=function(a,b){var c,d,e,f;if(l.runScripts)try{return f=[l._windowInScope,A],d=f[0],l._windowInScope=f[1],"string"==typeof a||a instanceof String?e=r.run(a,b):a&&(e=a.call(r)),l.emit("evaluated",a,e,b),e}catch(g){return c=g,c.filename||(c.filename=b),l.emit("error",c)}finally{l._windowInScope=d}},A.onerror=function(a){var b;return b=a.error||new Error("Error loading script"),l.emit("error",b)},q=l.eventLoop.createEventQueue(A),Object.defineProperties(A,{_eventQueue:{value:q},setTimeout:{value:q.setTimeout.bind(q)},clearTimeout:{value:q.clearTimeout.bind(q)},setInterval:{value:q.setInterval.bind(q)},clearInterval:{value:q.clearInterval.bind(q)},setImmediate:{value:function(a){return q.setTimeout(a,0)}},clearImmediate:{value:q.clearTimeout.bind(q)}}),A.open=function(a,b){return a=a&&d.resourceLoader.resolve(o,a),l.tabs.open({name:b,url:a,opener:A})},Object.defineProperty(A,"closed",{get:function(){return m},enumerable:!0}),A._destroy=function(){var a,b,c,d;if(!m){for(m=!0,d=A.frames,b=0,c=d.length;c>b;b++)a=d[b],a.close();q.destroy(),o.close(),A.dispose()}},A.close=function(){x||m||(l._windowInScope===v||null===l._windowInScope?(l.emit("closed",A),A._destroy(),s.destroy()):l.log("Scripts may not close windows that were not opened by script"))},s.updateLocation(A,z),B={forward:s.go.bind(s,1),back:s.go.bind(s,-1),go:s.go.bind(s),pushState:s.pushState.bind(s),replaceState:s.replaceState.bind(s),_submit:s.submit.bind(s),dump:s.dump.bind(s)},Object.defineProperties(B,{length:{get:function(){return s.length},enumerable:!0},state:{get:function(){return s.state},enumerable:!0}}),Object.defineProperties(A,{history:{value:B}}),l.emit("opened",A),A._submit=function(a){var b,c,e,f,g,h;switch(h=a.url,c=a.method,b=a.encoding,e=a.params,g=a.target,h=d.resourceLoader.resolve(o,h),g||(g="_self"),l.emit("submit",h,g),g){case"_self":f=A;break;case"_parent":f=A.parent;break;case"_top":f=A.top;break;default:f=l.tabs.open({name:g})}return f.history._submit({url:h,method:c,encoding:b,params:e})},n({document:o,history:s,url:z,method:t,encoding:p,params:w}),A},n=function(a){var b,c,d,e,f,g,i,j,k,l,m,n,o,p;switch(c=a.document,i=a.history,n=a.url,j=a.method,e=a.encoding,k=a.params,o=c.window,b=o.browser,o._response={},d=function(a){return a?b.emit("error",a):b.emit("loaded",c)},j=(j||"GET").toUpperCase(),"POST"===j&&(g={"content-type":e||"application/x-www-form-urlencoded"}),p=h.parse(n),m=p.protocol,l=p.pathname,m){case"about:":return c.open(),c.write("<html><body></body></html>"),c.close(),b.emit("loaded",c);case"javascript:":try{return o._evaluate(l,"javascript:"),b.emit("loaded",c)}catch(q){return f=q,b.emit("error",f)}break;case"http:":case"https:":case"file:":return g=g||{},g.referer||(g.referer=c.referrer),o._eventQueue.http(j,n,{headers:g,params:k,target:c},function(a,d){var e,f,g,h;return a?(c.open(),c.write("<html><body>"+(a.message||a)+"</body></html>"),c.close(),void b.emit("error",a)):(o._response=d,h=function(a){return c.removeEventListener("load",h),o.dispatchEvent(a)},c.addEventListener("load",h),g=function(){var a,b,d,e,f,g,h,j;if(e=c.querySelector("meta[http-equiv='refresh']")){if(a=e.getAttribute("content"),b=a.match(/^\s*(\d+)(?:\s*;\s*url\s*=\s*(.*?))?\s*(?:;|$)/i),!b)return;if(d=b[0],h=b[1],j=b[2],f=parseInt(h,10),g=j||c.location.href,f>=0)return o._eventQueue.enqueue(function(){var a;return i.replace(g),a=i.current.window,a.addEventListener("load",function(){return a._response.redirects++})})}},f=function(a){return c.removeEventListener("DOMContentLoaded",f),o.dispatchEvent(a),g()},c.addEventListener("DOMContentLoaded",f),o.browser.emit("loading",c),d.body&&(e=d.body.toString("utf8")),/<html>/.test(e)||(e="<html><body>"+(e||"")+"</body></html>"),i.updateLocation(o,d.url),c.open(),c.write(e),c.close(),d.statusCode>=400?b.emit("error",new Error("Server returned status code "+d.statusCode+" from "+n)):c.documentElement?b.emit("loaded",c):b.emit("error",new Error("Could not parse document at "+n)))});default:return b.emit("error",new Error("Cannot load resource "+n+", unsupported protocol"))}},m=d.Element.prototype.dispatchEvent,d.Node.prototype.dispatchEvent=function(a){var b,c,d,e,f,g,h;f=this,c=f.ownerDocument||f.document||f,g=c.parentWindow,b=g.browser,b.emit("event",a,f);try{return h=[b._windowInScope,g],e=h[0],b._windowInScope=h[1],g.event=a,m.call(f,a)}catch(i){return d=i,b.emit("error",d)}finally{delete g.event,b._windowInScope=e}},g=function(){function a(){this.top=this.left=0,this.width=1280,this.height=800}return a.prototype.__defineGetter__("availLeft",function(){return 0}),a.prototype.__defineGetter__("availTop",function(){return 0}),a.prototype.__defineGetter__("availWidth",function(){return 1280}),a.prototype.__defineGetter__("availHeight",function(){return 800}),a.prototype.__defineGetter__("colorDepth",function(){return 24}),a.prototype.__defineGetter__("pixelDepth",function(){return 24}),a}(),c=function(){function a(){}return a}()}.call(this),function(){var a,b,c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};b=require("jsdom").dom.level3.html,a=require("jsdom").dom.level3.events,c=require("url"),e=require("./scripts"),b.SECURITY_ERR=18,b.NETWORK_ERR=19,b.ABORT_ERR=20,d=function(d){function f(a){this._window=a,this._pending=[],this._responseHeaders=null,this.onreadystatechange=null,this.timeout=0,this.status=null,this.statusText=null,this.responseText=null,this.responseXML=null,this._ownerDocument=a.document,this._parentNode=a}return g(f,d),f.prototype.abort=function(){var a,c,d,e;for(e=this._pending,c=0,d=e.length;d>c;c++)a=e[c],a.error||(a.error=new b.DOMException(b.ABORT_ERR,"Request aborted"));return this.readyState=f.UNSENT},f.prototype.getAllResponseHeaders=function(a){var b,c,d;if(this._responseHeaders){b=[],d=this._responseHeaders;for(a in d)c=d[a],b.push(""+a+": "+c);return b.join("\n")}return null},f.prototype.getResponseHeader=function(a){return this._responseHeaders?this._responseHeaders[a.toLowerCase()]:null},f.prototype.open=function(a,d,e,g,h){var i,j;if(e===!1)throw new b.DOMException(b.NOT_SUPPORTED_ERR,"Zombie does not support synchronous XHR requests");if(this.abort(),a=a.toUpperCase(),/^(CONNECT|TRACE|TRACK)$/.test(a))throw new b.DOMException(b.SECURITY_ERR,"Unsupported HTTP method");if(!/^(DELETE|GET|HEAD|OPTIONS|POST|PUT)$/.test(a))throw new b.DOMException(b.SYNTAX_ERR,"Unsupported HTTP method");if(i={},d=c.parse(c.resolve(this._window.location.href,d)),("https:"===d.protocol&&"443"===d.port||"http:"===d.protocol&&"80"===d.port)&&delete d.port,!/^https?:$/i.test(d.protocol))throw new b.DOMException(b.NOT_SUPPORTED_ERR,"Only HTTP/S protocol supported");d.hostname||(d.hostname=this._window.location.hostname),d.host=d.host=d.port?""+d.hostname+":"+d.port:d.hostname,d.host!==this._window.location.host&&(i.origin=this._window.location.protocol+"//"+this._window.location.host,this._cors=i.origin),d.hash=null,g&&(d.auth=""+g+":"+h),this.status=null,this.statusText=null,this.responseText=null,this.responseXML=null,j={method:a,url:c.format(d),headers:i},this._pending.push(j),this._stateChanged(f.OPENED)},f.prototype.send=function(c){var d,e;if(this.readyState!==f.OPENED)throw new b.DOMException(b.INVALID_STATE_ERR,"Invalid state");d=this._pending[this._pending.length-1],(e=d.headers)["content-type"]||(e["content-type"]="text/plain"),d.body=c,d.timeout=this.timeout,this._window._eventQueue.http(d.method,d.url,d,function(c){return function(e,g){var h,i;return e||(e=d.error),e?(i=new a.Event("xhr"),i.initEvent("error",!0,!0),i.error=new b.DOMException(b.NETWORK_ERR,e.message),void c.dispatchEvent(i)):c._cors&&(h=g.headers["access-control-allow-origin"],"*"!==h&&h!==c._cors)?(i=new a.Event("xhr"),i.initEvent("error",!0,!0),i.error=new b.DOMException(b.SECURITY_ERR,"Cannot make request to different domain"),void c.dispatchEvent(i)):(c.status=g.statusCode,c.statusText=g.statusText,c._responseHeaders=g.headers,c._stateChanged(f.HEADERS_RECEIVED),c._window._eventQueue.enqueue(function(){var a;return c.responseText=(null!=(a=g.body)?a.toString():void 0)||"",c.responseXML=null,c._stateChanged(f.DONE)}))}}(this))},f.prototype.setRequestHeader=function(a,c){var d;if(this.readyState!==f.OPENED)throw new b.DOMException(b.INVALID_STATE_ERR,"Invalid state");d=this._pending[this._pending.length-1],d.headers[a.toString().toLowerCase()]=c.toString()},f.prototype._stateChanged=function(b){var c;return this.readyState=b,b===f.DONE&&(c=new a.Event("xhr"),c.initEvent("load",!1,!0),this.dispatchEvent(c)),this.onreadystatechange?this._window._eventQueue.enqueue(function(a){return function(){var b;try{return a.onreadystatechange.call(a)}catch(c){return b=c,e({element:a._window.document,from:__filename,scope:"XHR",error:b})}}}(this)):void 0},f}(a.EventTarget),d.UNSENT=0,d.OPENED=1,d.HEADERS_RECEIVED=2,d.LOADING=3,d.DONE=4,module.exports=d}.call(this);